

# **ã€Šä»Šæ—¥ç©¿æ­ã€‹APP Flutterå®¢æˆ·ç«¯éœ€æ±‚è¯´æ˜ä¹¦**

**æŠ€æœ¯æ ˆ**ï¼šFlutter 3.16+ (Dart 3.0+)  
**ç›®æ ‡å¹³å°**ï¼šiOS 12.0+ / Android 8.0+ (API 26+)  
**æ¶æ„æ¨¡å¼**ï¼šClean Architecture + BLoC (Business Logic Component)  
**çŠ¶æ€ç®¡ç†**ï¼šflutter_bloc (ç‰ˆæœ¬ 8.1+) + get_it (ä¾èµ–æ³¨å…¥)

---

## **1. æŠ€æœ¯æ¶æ„è§„èŒƒ**

### 1.1 é¡¹ç›®ç»“æ„ï¼ˆClean Architectureï¼‰

```
lib/
â”œâ”€â”€ core/                          # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ constants/                 # å¸¸é‡å®šä¹‰ï¼ˆAPIç«¯ç‚¹ã€é¢œè‰²ã€é—´è·ï¼‰
â”‚   â”œâ”€â”€ errors/                    # å¼‚å¸¸å¤„ç†ï¼ˆFailureã€Exceptionï¼‰
â”‚   â”œâ”€â”€ usecases/                  # é€šç”¨ç”¨ä¾‹åŸºç±»
â”‚   â”œâ”€â”€ utils/                     # å·¥å…·ç±»ï¼ˆæ—¥æœŸæ ¼å¼ã€æ­£åˆ™æ ¡éªŒï¼‰
â”‚   â”œâ”€â”€ network/                   # ç½‘ç»œå±‚ï¼ˆDioé…ç½®ã€æ‹¦æˆªå™¨ï¼‰
â”‚   â”œâ”€â”€ storage/                   # æœ¬åœ°å­˜å‚¨ï¼ˆHive/SharedPrefså°è£…ï¼‰
â”‚   â””â”€â”€ theme/                     # ä¸»é¢˜é…ç½®ï¼ˆThemeDataã€æš—é»‘æ¨¡å¼ï¼‰
â”œâ”€â”€ features/                      # ä¸šåŠ¡åŠŸèƒ½æ¨¡å—ï¼ˆæŒ‰åŠŸèƒ½åˆ’åˆ†ï¼‰
â”‚   â”œâ”€â”€ auth/                      # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ data/                  # æ•°æ®å±‚ï¼ˆmodelsã€repositories_implï¼‰
â”‚   â”‚   â”œâ”€â”€ domain/                # é¢†åŸŸå±‚ï¼ˆentitiesã€repositoriesã€usecasesï¼‰
â”‚   â”‚   â””â”€â”€ presentation/          # è¡¨ç°å±‚ï¼ˆblocsã€pagesã€widgetsï¼‰
â”‚   â”œâ”€â”€ feed/                      # å†…å®¹æµæ¨¡å—
â”‚   â”œâ”€â”€ post_editor/               # å‘å¸ƒç¼–è¾‘å™¨æ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ product_detail/            # å•†å“è¯¦æƒ…æ¨¡å—
â”‚   â”œâ”€â”€ user_profile/              # ç”¨æˆ·ä¸ªäººé¡µ
â”‚   â””â”€â”€ wallet/                    # é’±åŒ…/ä½£é‡‘æ¨¡å—
â”œâ”€â”€ shared/                        # è·¨æ¨¡å—å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ widgets/                   # é€šç”¨UIç»„ä»¶ï¼ˆæŒ‰é’®ã€åŠ è½½çŠ¶æ€ï¼‰
â”‚   â”œâ”€â”€ models/                    # å…±äº«æ¨¡å‹ï¼ˆUserã€MediaFileï¼‰
â”‚   â””â”€â”€ services/                  # å…±äº«æœåŠ¡ï¼ˆImagePickerã€DeepLinkï¼‰
â””â”€â”€ main.dart                      # åº”ç”¨å…¥å£
```

### 1.2 æŠ€æœ¯é€‰å‹çº¦æŸ

| ç±»åˆ« | é€‰å‹ | ç‰ˆæœ¬çº¦æŸ | è¯´æ˜ |
|------|------|---------|------|
| **çŠ¶æ€ç®¡ç†** | flutter_bloc | ^8.1.3 | ä¸¥æ ¼éµå¾ªå•å‘æ•°æ®æµï¼Œç¦æ­¢ç›´æ¥è°ƒç”¨setStateä¸šåŠ¡é€»è¾‘ |
| **ä¾èµ–æ³¨å…¥** | get_it + injectable | ^7.6.0 | è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ³¨å…¥ä»£ç ï¼Œç¡®ä¿å¯æµ‹è¯•æ€§ |
| **è·¯ç”±ç®¡ç†** | go_router | ^12.0.0 | å£°æ˜å¼è·¯ç”±ï¼Œæ”¯æŒDeep Linkingå’ŒWebï¼ˆæœªæ¥æ‰©å±•ï¼‰ |
| **ç½‘ç»œè¯·æ±‚** | dio | ^5.3.0 | ç»Ÿä¸€æ‹¦æˆªå™¨å¤„ç†Tokenåˆ·æ–°ã€é”™è¯¯é‡è¯•ã€ç¼“å­˜ |
| **æœ¬åœ°å­˜å‚¨** | hive | ^4.0.0 | å­˜å‚¨ç”¨æˆ·é…ç½®ã€è‰ç¨¿ç®±ã€é€‰å“åº“ç¼“å­˜ï¼ˆæ¯”SharedPrefå¿«10å€ï¼‰ |
| **å›¾ç‰‡å¤„ç†** | image_picker + photo_manager | ^1.0.0 | ç›¸å†Œå¤šé€‰ã€å‹ç¼©ã€EXIFè¯»å– |
| **å›¾ç‰‡é¢„è§ˆ** | extended_image | ^8.1.0 | æ”¯æŒæ‰‹åŠ¿ç¼©æ”¾ã€æ‹–æ‹½è¿”å›ã€å†…å­˜ç®¡ç†ä¼˜åŒ– |
| **è§†é¢‘æ’­æ”¾** | chewie (åŸºäºvideo_player) | ^1.7.0 | å•†å“è§†é¢‘å±•ç¤ºï¼ˆFutureï¼‰ |
| **å›¾è¡¨** | fl_chart | ^0.65.0 | æ•°æ®çœ‹æ¿æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ |
| **æ‰«ç ** | mobile_scanner | ^3.5.0 | è¯†åˆ«æ·˜å®/äº¬ä¸œå•†å“äºŒç»´ç å¯¼å…¥ |
| **æœ¬åœ°é€šçŸ¥** | flutter_local_notifications | ^16.0.0 | ä½£é‡‘åˆ°è´¦æé†’ã€å®¡æ ¸é€šçŸ¥ |
| **è·¯å¾„å¯¼èˆª** | url_launcher | ^6.2.0 | å”¤èµ·æ·˜å®APPã€å®¢æœèŠå¤© |

**ç¦æ­¢ä½¿ç”¨çš„åº“**ï¼š
- getxï¼ˆä¸Clean Architectureå†²çªï¼Œéš¾ä»¥æµ‹è¯•ï¼‰
- providerï¼ˆé¡¹ç›®ç»Ÿä¸€ä½¿ç”¨BLoCï¼‰
- æœªç»å®‰å…¨å®¡æŸ¥çš„ç¬¬ä¸‰æ–¹ç™»å½•SDK

---

## **2. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—å®ç°è§„èŒƒ**

### 2.1 å›¾ç‰‡æ ‡ç­¾ç¼–è¾‘å™¨ï¼ˆæ ¸å¿ƒå¤æ‚ç»„ä»¶ï¼‰

#### 2.1.1 ç»„ä»¶æ¶æ„

**æ¨¡å—è·¯å¾„**ï¼š`lib/features/post_editor/presentation/widgets/`

```dart
// ä¸»ç¼–è¾‘å™¨ç»„ä»¶
class ImageTagEditor extends StatefulWidget {
  final List<File> images;                    // å·²é€‰å›¾ç‰‡æ–‡ä»¶
  final List<TagModel> initialTags;           // åˆå§‹æ ‡ç­¾ï¼ˆè‰ç¨¿æ¢å¤ï¼‰
  final Function(List<TagModel>) onTagsChanged; // æ ‡ç­¾å˜æ›´å›è°ƒ
  
  @override
  _ImageTagEditorState createState() => _ImageTagEditorState();
}

// æ ‡ç­¾æ•°æ®æ¨¡å‹
class TagModel {
  final String id;                           // UUID v4
  final int imageIndex;                      // å›¾ç‰‡ç´¢å¼•ï¼ˆ0-8ï¼‰
  final Offset relativePosition;             // ç›¸å¯¹åæ ‡ï¼ˆ0.0-1.0ï¼‰
  final ProductModel product;                // å…³è”å•†å“
  final DateTime createdAt;
  
  TagModel({
    required this.id,
    required this.imageIndex,
    required this.relativePosition,
    required this.product,
    DateTime? createdAt,
  }) : createdAt = createdAt ?? DateTime.now();
}
```

#### 2.1.2 äº¤äº’æ‰‹åŠ¿è§„èŒƒ

| æ‰‹åŠ¿ | è§¦å‘åŒºåŸŸ | è¡Œä¸º | è§†è§‰åé¦ˆ |
|------|---------|------|---------|
| **é•¿æŒ‰** | å›¾ç‰‡ä»»æ„ä½ç½®ï¼ˆ>600msï¼‰ | åˆ›å»ºæ–°æ ‡ç­¾ | æ˜¾ç¤ºæ¶Ÿæ¼ªåŠ¨ç”»+éœ‡åŠ¨åé¦ˆï¼ˆHapticFeedback.mediumImpactï¼‰ |
| **æ‹–æ‹½** | å·²å­˜åœ¨æ ‡ç­¾ | ç§»åŠ¨æ ‡ç­¾ä½ç½® | æ ‡ç­¾æ”¾å¤§1.2å€ï¼ŒåŠé€æ˜é˜´å½±ï¼Œè·Ÿéšæ‰‹æŒ‡ç§»åŠ¨ |
| **å•å‡»** | å·²å­˜åœ¨æ ‡ç­¾ | é€‰ä¸­/ç¼–è¾‘å•†å“ | æ ‡ç­¾é«˜äº®ï¼ˆè“è‰²åœ†ç¯ï¼‰ï¼Œåº•éƒ¨å¼¹å‡ºå•†å“ç¼–è¾‘é¢æ¿ |
| **åŒå‡»** | å›¾ç‰‡åŒºåŸŸ | ç¼©æ”¾å›¾ç‰‡ | åŒå‡»æ”¾å¤§è‡³2å€/è¿˜åŸï¼Œä½¿ç”¨ExtendedImageæ‰‹åŠ¿ |
| **æåˆ** | å›¾ç‰‡åŒºåŸŸ | è‡ªç”±ç¼©æ”¾ | æœ€å°1å€ï¼Œæœ€å¤§4å€ï¼ŒåŒæŒ‡æ“ä½œæ—¶æ ‡ç­¾éšè—é¿å…è¯¯è§¦ |

#### 2.1.3 åæ ‡ç³»è®¡ç®—é€»è¾‘

**å…³é”®ç®—æ³•**ï¼šå°†è§¦æ‘¸åæ ‡è½¬æ¢ä¸ºæ ‡å‡†åŒ–ç›¸å¯¹åæ ‡ï¼Œç¡®ä¿ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ ‡ç­¾ä½ç½®ä¸€è‡´æ€§ã€‚

```dart
// åæ ‡è½¬æ¢ä¼ªä»£ç 
Offset calculateRelativePosition(
  Offset localPosition,      // æ‰‹æŒ‡è§¦æ‘¸åæ ‡ï¼ˆç›¸å¯¹äºStackï¼‰
  Size containerSize,        // å›¾ç‰‡å®¹å™¨å°ºå¯¸
  double imageAspectRatio,   // å›¾ç‰‡åŸå§‹å®½é«˜æ¯”
) {
  // å¤„ç†å›¾ç‰‡å¡«å……æ¨¡å¼ï¼ˆBoxFit.containï¼‰ä¸‹çš„é»‘è¾¹é—®é¢˜
  final fittedSize = applyBoxFit(
    BoxFit.contain,
    Size(imageAspectRatio * 100, 100),
    containerSize,
  );
  
  // è®¡ç®—å›¾ç‰‡åœ¨å®¹å™¨å†…çš„å®é™…åç§»ï¼ˆå±…ä¸­æ—¶çš„è¾¹è·ï¼‰
  final horizontalPadding = (containerSize.width - fittedSize.destination.width) / 2;
  final verticalPadding = (containerSize.height - fittedSize.destination.height) / 2;
  
  // åªè®¡ç®—å›¾ç‰‡åŒºåŸŸå†…çš„åæ ‡
  final x = (localPosition.dx - horizontalPadding) / fittedSize.destination.width;
  final y = (localPosition.dy - verticalPadding) / fittedSize.destination.height;
  
  // é’³åˆ¶åˆ°0-1èŒƒå›´ï¼Œé˜²æ­¢è¶…å‡ºè¾¹ç¼˜
  return Offset(
    x.clamp(0.0, 1.0),
    y.clamp(0.0, 1.0),
  );
}
```

#### 2.1.4 æ€§èƒ½ä¼˜åŒ–è¦æ±‚

- **RepaintBoundary**ï¼šæ¯ä¸ªæ ‡ç­¾ä½¿ç”¨RepaintBoundaryåŒ…è£¹ï¼Œé¿å…æ ‡ç­¾åŠ¨ç”»å¯¼è‡´æ•´ä¸ªå›¾ç‰‡é‡ç»˜
- **å›¾ç‰‡é¢„åŠ è½½**ï¼šä½¿ç”¨`precacheImage`é¢„åŠ è½½å‰åå„1å¼ å›¾ç‰‡ï¼Œåˆ‡æ¢æ—¶æ— ç™½å±
- **é˜²æŠ–å¤„ç†**ï¼šæ ‡ç­¾æ‹–æ‹½åœæ­¢500msåæ‰ä¿å­˜åæ ‡åˆ°çŠ¶æ€ï¼Œå‡å°‘setStateé¢‘ç‡
- **å†…å­˜ç®¡ç†**ï¼šå›¾ç‰‡ä½¿ç”¨`ResizeImage`é™åˆ¶æœ€å¤§åˆ†è¾¨ç‡ä¸º1920x1920ï¼Œé˜²æ­¢OOM

### 2.2 ç›¸å†Œé€‰æ‹©ä¸å›¾ç‰‡å¤„ç†

**ç»„ä»¶**ï¼š`lib/shared/services/image_picker_service.dart`

#### 2.2.1 é€‰æ‹©å™¨é…ç½®

```dart
class ImagePickerService {
  // ä½¿ç”¨photo_managerå®ç°åŸç”Ÿç›¸å†Œä½“éªŒ
  Future<List<AssetEntity>> pickImages({
    required int maxCount,           // é™åˆ¶9å¼ 
    required int maxWidth,           // å‹ç¼©è‡³1080pxå®½åº¦
    required int maxHeight,          // å‹ç¼©è‡³1440pxé«˜åº¦
    required int compressQuality,    // è´¨é‡85%
  }) async {
    // å¿…é¡»æ”¯æŒHEICè‡ªåŠ¨è½¬JPEGï¼ˆiOSï¼‰
    // å¿…é¡»è¯»å–å›¾ç‰‡EXIFï¼Œè®°å½•æ‹æ‘„æ—¶é—´ç”¨äºæ’åº
    // Androidéœ€å¤„ç†åˆ†åŒºå­˜å‚¨æƒé™ï¼ˆscoped storageï¼‰
  }
}
```

#### 2.2.2 å‹ç¼©ç­–ç•¥

| åœºæ™¯ | è¾“å…¥é™åˆ¶ | è¾“å‡ºè§„æ ¼ | è´¨é‡ | ç›®çš„ |
|------|---------|---------|------|------|
| å‘å¸ƒç¼–è¾‘ | åŸå§‹å›¾ç‰‡ | 1080Ã—1440ï¼ˆ3:4ï¼‰ | 85% | å¹³è¡¡æ¸…æ™°åº¦ä¸ä¸Šä¼ é€Ÿåº¦ |
| Feedæµé¢„è§ˆ | å‹ç¼©åå¤§å›¾ | 480Ã—640 | 80% | èŠ‚çœæµé‡ï¼Œå¿«é€ŸåŠ è½½ |
| ç¼©ç•¥å›¾ | å‹ç¼©åå¤§å›¾ | 150Ã—200 | 75% | åˆ—è¡¨å¿«é€Ÿæ»šåŠ¨ä¸å¡é¡¿ |

**å®ç°**ï¼šä½¿ç”¨`flutter_image_compress`åº“ï¼Œå¼‚æ­¥ isolate å¤„ç†é¿å…UIå¡é¡¿ã€‚

### 2.3 è·¨å¹³å°å”¤èµ·ç”µå•†APP

**æ¨¡å—**ï¼š`lib/shared/services/deep_link_service.dart`

#### 2.3.1 å¹³å°é€‚é…çŸ©é˜µ

| å¹³å° | ç›®æ ‡APP | æ–¹æ¡ˆ | å®ç°ç»†èŠ‚ |
|------|---------|------|---------|
| **iOS** | æ·˜å® | Universal Link + URL Scheme | å…ˆå°è¯•`taobao://s.click.taobao.com/xxx`ï¼Œå¤±è´¥åˆ™è·³è½¬App Store |
| **iOS** | äº¬ä¸œ | URL Scheme | `openApp.jdMobile://virtual?params=...` |
| **Android** | æ·˜å® | URL Scheme + Intent | `intent://s.click.taobao.com/xxx#Intent;package=com.taobao.taobao;scheme=https;end` |
| **Android** | äº¬ä¸œ | URL Scheme | `openApp.jdMobile://` |
| **Fallback** | æœªå®‰è£…APP | H5ä¸­é—´é¡µ | æ‰“å¼€å†…ç½®WebViewæ˜¾ç¤ºå•†å“ï¼Œé¡¶éƒ¨æç¤º"æ‰“å¼€APPæŸ¥çœ‹æ›´å¤šä¼˜æƒ " |

#### 2.3.2 æ·˜å£ä»¤è§£æä¸å¤åˆ¶

```dart
class TaobaoService {
  // è‡ªåŠ¨è¯†åˆ«å‰ªåˆ‡æ¿æ·˜å£ä»¤
  Future<void> detectClipboard() async {
    final clipboard = await Clipboard.getData('text/plain');
    final pattern = RegExp(r'[ï¿¥$Â¢â‚¬Â£]([a-zA-Z0-9]{11})[ï¿¥$Â¢â‚¬Â£]');
    final match = pattern.firstMatch(clipboard?.text ?? '');
    
    if (match != null) {
      // æ˜¾ç¤ºæ‚¬æµ®æç¤ºï¼š"æ£€æµ‹åˆ°æ·˜å£ä»¤ï¼Œæ˜¯å¦ç«‹å³æŸ¥çœ‹å•†å“ï¼Ÿ"
      // è§£ææ·˜å£ä»¤è·å–å•†å“ä¿¡æ¯ï¼ˆéœ€åç«¯æ”¯æŒæˆ–æ·˜å®APIï¼‰
    }
  }
  
  // å¤åˆ¶æ·˜å£ä»¤åˆ°ç³»ç»Ÿå‰ªåˆ‡æ¿
  Future<void> copyTpwd(String tpwd) async {
    await Clipboard.setData(ClipboardData(text: tpwd));
    // æ˜¾ç¤ºToastï¼š"æ·˜å£ä»¤å·²å¤åˆ¶ï¼Œæ‰“å¼€æ·˜å®å³å¯æŸ¥çœ‹"
    // iOSéœ€è¦æç¤ºç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢APPï¼ŒAndroidå¯ç›´æ¥å°è¯•å”¤èµ·
  }
}
```

---

## **3. é¡µé¢è¯¦ç»†è§„èŒƒ**

### 3.1 å‘å¸ƒç¼–è¾‘é¡µï¼ˆPostEditorPageï¼‰

**è·¯ç”±**ï¼š`/post/edit`  
**çŠ¶æ€ç®¡ç†**ï¼š`PostEditorCubit`ï¼ˆç”¨äºç®¡ç†å¤šæ­¥éª¤çŠ¶æ€æœºï¼‰

#### 3.1.1 é¡µé¢çŠ¶æ€æœº

```
[é€‰æ‹©å›¾ç‰‡] --> [ç¼–è¾‘æ ‡ç­¾] --> [æ·»åŠ æ–‡æ¡ˆ] --> [é€‰æ‹©è¯é¢˜] --> [å‘å¸ƒä¸­] --> [å‘å¸ƒæˆåŠŸ]
    â”‚              â”‚              â”‚             â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      (ä»»æ„æ­¥éª¤å¯ä¿å­˜è‰ç¨¿è‡³Hive)
```

#### 3.1.2 UIå¸ƒå±€ç»“æ„

**é¡¶éƒ¨å¯¼èˆªæ **ï¼š
- å·¦ä¾§ï¼šå…³é—­æŒ‰é’®ï¼ˆè¿”å›æç¤º"æ˜¯å¦ä¿å­˜è‰ç¨¿ï¼Ÿ"ï¼‰
- æ ‡é¢˜ï¼š"å‘å¸ƒç©¿æ­"ï¼ˆæ­¥éª¤æŒ‡ç¤ºå™¨ï¼š1/3æ ‡ç­¾ Â· 2/3æ–‡æ¡ˆ Â· 3/3å‘å¸ƒï¼‰
- å³ä¾§ï¼š"ä¸‹ä¸€æ­¥"æŒ‰é’®ï¼ˆç¦ç”¨çŠ¶æ€é€»è¾‘ï¼šå½“å‰æ­¥éª¤æœªå®Œæˆæ—¶ç°è‰²ï¼‰

**ä¸»ä½“åŒºåŸŸï¼ˆç™¾åˆ†æ¯”å¸ƒå±€ï¼‰**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â† é¡¶éƒ¨å®‰å…¨åŒºï¼ˆ notch é€‚é…ï¼‰
â”‚ å›¾ç‰‡é¢„è§ˆåŒº (60% å±å¹•é«˜åº¦)     â”‚
â”‚  [PageView + æŒ‡ç¤ºå™¨]         â”‚
â”‚  å½“å‰å›¾ç‰‡æ ‡ç­¾å åŠ å±‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åº•éƒ¨æ“ä½œé¢æ¿ (40% å±å¹•é«˜åº¦)    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tabæ : é€‰å“åº“ | ç²˜è´´é“¾æ¥ â”‚ â”‚
â”‚  â”‚                        â”‚ â”‚
â”‚  â”‚ å†…å®¹åŒºåŸŸ:               â”‚ â”‚
â”‚  â”‚ - æœç´¢æ¡†               â”‚ â”‚
â”‚  â”‚ - å•†å“åˆ—è¡¨ï¼ˆç½‘æ ¼2åˆ—ï¼‰    â”‚ â”‚
â”‚  â”‚   [å•†å“å¡]             â”‚ â”‚
â”‚  â”‚   - ä¸»å›¾              â”‚ â”‚
â”‚  â”‚   - æ ‡é¢˜ï¼ˆ1è¡Œæˆªæ–­ï¼‰      â”‚ â”‚
â”‚  â”‚   - åˆ¸åä»· + é¢„ä¼°ä½£      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’ç»†èŠ‚**ï¼š
- å›¾ç‰‡åˆ‡æ¢æ—¶ï¼šæ ‡ç­¾ç¼–è¾‘å™¨ä½¿ç”¨`Hero`åŠ¨ç”»å¹³æ»‘è¿‡æ¸¡
- é”®ç›˜å¼¹å‡ºæ—¶ï¼šåº•éƒ¨é¢æ¿é«˜åº¦è‡ªé€‚åº”ï¼Œä½¿ç”¨`MediaQuery.viewInsets.bottom`
- æ ‡ç­¾å†²çªæ£€æµ‹ï¼šä¸¤ä¸ªæ ‡ç­¾ä¸­å¿ƒç‚¹è·ç¦»<30pxæ—¶ï¼Œè‡ªåŠ¨å¾®è°ƒä½ç½®é¿å…é‡å 

#### 3.1.3 è‰ç¨¿ç®±æœºåˆ¶ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰

```dart
// ä½¿ç”¨Hiveåœ¨æ¯æ¬¡æ“ä½œå5ç§’è‡ªåŠ¨ä¿å­˜
class DraftManager {
  static const String _boxName = 'post_drafts';
  
  Future<void> autoSave(PostDraft draft) async {
    final box = await Hive.openBox<PostDraft>(_boxName);
    await box.put('current_draft', draft);
  }
  
  // æ¢å¤æ—¶æ£€æŸ¥ï¼š
  // 1. å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆå¯èƒ½è¢«ç³»ç»Ÿæ¸…ç†ï¼‰
  // 2. è½¬é“¾åçš„URLæ˜¯å¦è¿‡æœŸï¼ˆè”ç›Ÿé“¾æ¥æœ‰æ•ˆæœŸé€šå¸¸ä¸º30å¤©ï¼‰
}
```

### 3.2 Feedæµé¡µé¢ï¼ˆFeedPageï¼‰

**è·¯ç”±**ï¼š`/`ï¼ˆé¦–é¡µé»˜è®¤ï¼‰  
**çŠ¶æ€ç®¡ç†**ï¼š`FeedBloc`ï¼ˆå¤„ç†åˆ†é¡µã€ä¸‹æ‹‰åˆ·æ–°ã€å–œæ¬¢æ“ä½œï¼‰

#### 3.2.1 ç€‘å¸ƒæµå¸ƒå±€

**ç»„ä»¶**ï¼šä½¿ç”¨`flutter_staggered_grid_view`å®ç°åŒåˆ—ç€‘å¸ƒæµ

```dart
StaggeredGridView.countBuilder(
  crossAxisCount: 2,                    // åŒåˆ—
  itemCount: posts.length,
  itemBuilder: (context, index) => PostCard(post: posts[index]),
  staggeredTileBuilder: (index) => 
      const StaggeredTile.fit(1),      // é«˜åº¦è‡ªé€‚åº”
  mainAxisSpacing: 8.0,
  crossAxisSpacing: 8.0,
);
```

**å¡ç‰‡é«˜åº¦è®¡ç®—**ï¼š
- å›¾ç‰‡é«˜åº¦ï¼šæŒ‰åŸå§‹å®½é«˜æ¯”è®¡ç®—ï¼Œé™åˆ¶æœ€å¤§é«˜åº¦ä¸ºå±å¹•å®½åº¦çš„1.2å€
- åº•éƒ¨ä¿¡æ¯åŒºï¼šå›ºå®š80pxï¼ˆå¤´åƒ+æ ‡é¢˜+å•†å“æ•°é‡è§’æ ‡ï¼‰

#### 3.2.2 å›¾ç‰‡åŠ è½½ç­–ç•¥

| åœºæ™¯ | ç­–ç•¥ | å ä½å›¾ |
|------|------|--------|
| é¦–å± | ç«‹å³åŠ è½½ï¼Œä¼˜å…ˆçº§é«˜ | éª¨æ¶å±ï¼ˆä¸»è‰²è°ƒç°è‰²ï¼‰ |
| ä¸‹æ»‘è‡³å±å¹•å¤–1å± | å»¶è¿ŸåŠ è½½ï¼ˆIntersectionObserverï¼‰ | ä½åˆ†è¾¨ç‡æ¨¡ç³Šé¢„è§ˆ |
| å¿«é€Ÿæ»‘åŠ¨æ—¶ | æš‚åœåŠ è½½ï¼Œåœæ­¢æ—¶æ¢å¤ | çº¯è‰²å ä½ |
| è¯¦æƒ…è¿”å›åˆ—è¡¨ | ä»å†…å­˜ç¼“å­˜ç›´æ¥æ¸²æŸ“ï¼Œæ— é—ªçƒ | - |

**é¢„åŠ è½½å‚æ•°**ï¼š`precacheRows: 2`ï¼ˆå½“å‰å¯è§è¡Œä¸Šä¸‹å„é¢„åŠ è½½2è¡Œï¼‰

#### 3.2.3 å•†å“æ ‡ç­¾åœ¨Feedä¸­çš„é¢„è§ˆ

- å›¾ç‰‡å³ä¸‹è§’æ˜¾ç¤ºåŠé€æ˜è§’æ ‡ï¼š`ğŸ·ï¸ 3`ï¼ˆè¡¨ç¤ºå«3ä¸ªå¯è´­ä¹°å•†å“ï¼‰
- ç‚¹å‡»è§’æ ‡ç›´æ¥è¿›å…¥å¸–å­è¯¦æƒ…ï¼Œè‡ªåŠ¨å±•å¼€å•†å“åˆ—è¡¨

### 3.3 å¸–å­è¯¦æƒ…é¡µï¼ˆPostDetailPageï¼‰

**è·¯ç”±**ï¼š`/post/:id`  
**Deep Linkæ”¯æŒ**ï¼š`https://app.jinrichuanda.com/post/123`

#### 3.3.1 å¸ƒå±€ç»“æ„ï¼ˆçºµå‘æ»‘åŠ¨ï¼‰

```
[HeroåŠ¨ç”»å›¾ç‰‡å¤´å›¾ï¼ˆå¯ç¼©æ”¾ï¼‰]
    â†“ ä¸‹æ»‘
â”œâ”€ ç”¨æˆ·ä¿¡æ¯æ ï¼ˆå¤´åƒã€æ˜µç§°ã€å…³æ³¨æŒ‰é’®ï¼‰
â”œâ”€ æ–‡æ¡ˆåŒºåŸŸï¼ˆå¯å±•å¼€å…¨æ–‡ï¼‰
â”œâ”€ æ ‡ç­¾çƒ­åŠ›å›¾åŒºåŸŸï¼ˆå¯ç‚¹å‡»åœ†ç‚¹ï¼‰
â”‚   å›¾ç‰‡ + å åŠ å•†å“æ ‡ç­¾ï¼ˆè„‰å†²åŠ¨ç”»ï¼‰
â”œâ”€ å•†å“åˆ—è¡¨å¡ç‰‡ï¼ˆæ¨ªå‘æ»‘åŠ¨æˆ–å‚ç›´åˆ—è¡¨ï¼‰
â”‚   â”œâ”€ [å•†å“å¡1] å›¾ + æ ‡é¢˜ + ä»·æ ¼ + è´­ä¹°æŒ‰é’®
â”‚   â”œâ”€ [å•†å“å¡2] ...
â”œâ”€ è¯„è®ºåŒºï¼ˆæ¥¼ä¸­æ¥¼ç»“æ„ï¼‰
â””â”€ åº•éƒ¨å›ºå®šæ“ä½œæ ï¼ˆç‚¹èµã€æ”¶è—ã€è¯„è®ºè¾“å…¥æ¡†ã€åˆ†äº«ï¼‰
```

#### 3.3.2 å•†å“å¡ç‰‡ç»„ä»¶ï¼ˆProductCardï¼‰

```dart
class ProductCard extends StatelessWidget {
  final ProductModel product;
  final VoidCallback onTap;
  
  @override
  Widget build(BuildContext context) {
    return Card(
      child: InkWell(
        onTap: onTap,
        child: Column(
          children: [
            // å•†å“å›¾ï¼ˆåœ†è§’16pxï¼‰
            ClipRRect(
              borderRadius: BorderRadius.vertical(top: Radius.circular(16)),
              child: Image.network(
                product.imageUrl,
                height: 120,
                fit: BoxFit.cover,
                // å¿…é¡»æ·»åŠ ç¼“å­˜ï¼ˆCachedNetworkImageï¼‰
              ),
            ),
            Padding(
              padding: EdgeInsets.all(12),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  // æ ‡é¢˜ï¼ˆæœ€å¤š2è¡Œï¼Œæˆªæ–­æ˜¾ç¤º...ï¼‰
                  Text(
                    product.title,
                    maxLines: 2,
                    overflow: TextOverflow.ellipsis,
                    style: TextStyle(fontSize: 14),
                  ),
                  SizedBox(height: 8),
                  // ä»·æ ¼è¡Œï¼ˆåˆ¸åä»·çº¢è‰²é«˜äº®ï¼ŒåŸä»·ç°è‰²åˆ é™¤çº¿ï¼‰
                  Row(
                    children: [
                      Text(
                        'Â¥${product.finalPrice}',
                        style: TextStyle(
                          color: Colors.red,
                          fontSize: 18,
                          fontWeight: FontWeight.bold,
                        ),
                      ),
                      if (product.originalPrice > product.finalPrice)
                        Text(
                          'Â¥${product.originalPrice}',
                          style: TextStyle(
                            color: Colors.grey,
                            fontSize: 12,
                            decoration: TextDecoration.lineThrough,
                          ),
                        ),
                      Spacer(),
                      // ä½£é‡‘æ ‡ç­¾ï¼ˆä»…è¾¾äººè‡ªå·±å¯è§ï¼‰
                      if (isCurrentUserAuthor)
                        Container(
                          padding: EdgeInsets.symmetric(horizontal: 6, vertical: 2),
                          decoration: BoxDecoration(
                            color: Colors.orange.withOpacity(0.1),
                            borderRadius: BorderRadius.circular(4),
                          ),
                          child: Text(
                            'èµšÂ¥${product.commission}',
                            style: TextStyle(color: Colors.orange, fontSize: 10),
                          ),
                        ),
                    ],
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

### 3.4 æ•°æ®çœ‹æ¿é¡µï¼ˆAnalyticsPageï¼‰

**è·¯ç”±**ï¼š`/profile/analytics`  
**å›¾è¡¨åº“**ï¼š`fl_chart`

#### 3.4.1 å›¾è¡¨äº¤äº’éœ€æ±‚

- **GMVè¶‹åŠ¿å›¾**ï¼šæŠ˜çº¿å›¾ï¼Œæ”¯æŒåˆ‡æ¢æ—¶é—´ç»´åº¦ï¼ˆ7æ—¥/30æ—¥/90æ—¥ï¼‰
    - Xè½´ï¼šæ—¥æœŸ
    - Yè½´ï¼šé‡‘é¢ï¼ˆè‡ªé€‚åº”å•ä½ï¼Œè¿‡ä¸‡æ˜¾ç¤º"ä¸‡"ï¼‰
    - è§¦æ‘¸æç¤ºï¼šæ˜¾ç¤ºå½“æ—¥å…·ä½“é‡‘é¢ï¼Œç«–çº¿æŒ‡ç¤ºå™¨

- **å•†å“è½¬åŒ–æ¼æ–—**ï¼šæŸ±çŠ¶å›¾
    - æ›å…‰ â†’ ç‚¹å‡» â†’ åŠ è´­ â†’ æˆäº¤ï¼ˆå¦‚æ•°æ®å¯è·å¾—ï¼‰
    - æ¯ç¯èŠ‚æ˜¾ç¤ºè½¬åŒ–ç‡ç™¾åˆ†æ¯”

- **ç±»ç›®åˆ†å¸ƒé¥¼å›¾**ï¼šå¸¦è´§å•†å“ç±»ç›®å æ¯”ï¼ˆä¸Šè¡£35%ã€è£¤è£…20%...ï¼‰

---

## **4. åŸç”ŸåŠŸèƒ½é›†æˆï¼ˆPlatform Channelï¼‰**

### 4.1 å¿…é¡»é›†æˆçš„åŸç”Ÿèƒ½åŠ›

#### 4.1.1 iOSç‰¹å®š

| åŠŸèƒ½ | Podä¾èµ– | ç”¨é€” |
|------|---------|------|
| **Universal Link** | åŸç”Ÿé…ç½® | ä»æ·˜å®åˆ†äº«é“¾æ¥è·³è½¬å›APP |
| **Keychain** | `flutter_secure_storage` | å®‰å…¨å­˜å‚¨PIDç­‰æ•æ„Ÿä¿¡æ¯ |
| **ç…§ç‰‡æƒé™** | `photo_manager` | iOS 14+ æœ‰é™è®¿é—®æƒé™é€‚é… |
| **ç½‘ç»œçŠ¶æ€** | `connectivity_plus` | æ£€æµ‹WiFi/èœ‚çªï¼Œæ§åˆ¶è§†é¢‘è‡ªåŠ¨æ’­æ”¾ |

**Info.plisté…ç½®**ï¼š
```xml
<key>LSApplicationQueriesSchemes</key>
<array>
    <string>taobao</string>
    <string>openApp.jdMobile</string>
    <string>tmall</string>
</array>
<key>NSPhotoLibraryUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©ç©¿æ­å›¾ç‰‡</string>
<key>NSCameraUsageDescription</key>
<string>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„ç©¿æ­ç…§ç‰‡</string>
```

#### 4.1.2 Androidç‰¹å®š

| åŠŸèƒ½ | Gradleé…ç½® | æ³¨æ„äº‹é¡¹ |
|------|-----------|---------|
| **FileProvider** | AndroidManifest.xml | åˆ†äº«å›¾ç‰‡åˆ°å¾®ä¿¡/å¾®åšæ—¶éœ€è¦ |
| **å­˜å‚¨æƒé™** | `permission_handler` | Android 10+ åˆ†åŒºå­˜å‚¨é€‚é…ï¼ˆScoped Storageï¼‰ |
| **åå°ä¸‹è½½** | `flutter_downloader` | æ‰¹é‡ä¿å­˜ç©¿æ­å›¾ç‰‡åˆ°ç›¸å†Œ |
| **è¿”å›é”®å¤„ç†** | åŸç”Ÿé‡å†™ | åº•éƒ¨å¼¹çª—æ‰“å¼€æ—¶ä¼˜å…ˆå…³é—­å¼¹çª—è€Œéé€€å‡ºé¡µé¢ |

**AndroidManifest.xmlå…³é”®é…ç½®**ï¼š
```xml
<queries>
    <intent>
        <action android:name="android.intent.action.VIEW" />
        <data android:scheme="taobao" />
    </intent>
</queries>

<provider
    android:name="androidx.core.content.FileProvider"
    android:authorities="${applicationId}.fileprovider"
    android:exported="false"
    android:grantUriPermissions="true">
    <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/file_paths" />
</provider>
```

### 4.2 MethodChannelè®¾è®¡ï¼ˆå¦‚éœ€è‡ªå®šä¹‰åŸç”ŸåŠŸèƒ½ï¼‰

```dart
// ç¤ºä¾‹ï¼šæ£€æµ‹ç›®æ ‡APPæ˜¯å¦å®‰è£…
class AppCheckChannel {
  static const platform = MethodChannel('com.jinrichuanda/appcheck');
  
  static Future<bool> isAppInstalled(String packageName) async {
    try {
      final result = await platform.invokeMethod<bool>(
        'isAppInstalled', 
        {'packageName': packageName},
      );
      return result ?? false;
    } on PlatformException catch (e) {
      return false;
    }
  }
}
```

---

## **5. æ€§èƒ½ä¸ä½“éªŒä¼˜åŒ–**

### 5.1 å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

**ç›®æ ‡**ï¼šå†·å¯åŠ¨ < 2ç§’ï¼ˆä¸­ä½ç«¯æœºå‹ï¼‰

**æªæ–½**ï¼š
1. **å»¶è¿Ÿåˆå§‹åŒ–**ï¼šéå…³é”®SDKï¼ˆç»Ÿè®¡ã€æ¨é€ï¼‰åœ¨é¦–é¡µé¦–å¸§æ¸²æŸ“ååˆå§‹åŒ–
2. **Dart VMå¯åŠ¨**ï¼šä½¿ç”¨`flutter_native_splash`ç”ŸæˆåŸç”Ÿå¯åŠ¨å±ï¼Œé¿å…ç™½å±
3. **é¦–é¡µé¢„åŠ è½½**ï¼šå¯åŠ¨æ—¶å¹¶è¡Œè¯·æ±‚Feedç¬¬ä¸€é¡µæ•°æ®ï¼Œé¦–é¡µWidgetæ„å»ºå®Œæˆåç«‹å³æ¸²æŸ“
4. **èµ„æºç˜¦èº«**ï¼šå›¾ç‰‡èµ„æºä½¿ç”¨WebPæ ¼å¼ï¼Œå­—ä½“æ–‡ä»¶å­é›†åŒ–ï¼ˆåªåŒ…å«å¸¸ç”¨å­—ç¬¦ï¼‰

### 5.2 å†…å­˜ç®¡ç†

**å›¾ç‰‡å†…å­˜ç­–ç•¥**ï¼š
```dart
// ä½¿ç”¨ExtendedImageçš„å†…å­˜ç¼“å­˜é…ç½®
ExtendedImageProvider(
  cacheRawData: true,           // ç¼“å­˜å‹ç¼©å‰æ•°æ®
  imageCacheName: 'feed_cache', 
);

// åˆ—è¡¨æ»šåŠ¨æ—¶æš‚åœå›¾ç‰‡åŠ è½½
NotificationListener<ScrollNotification>(
  onNotification: (notification) {
    if (notification is ScrollStartNotification) {
      // æš‚åœåŠ è½½
    } else if (notification is ScrollEndNotification) {
      // æ¢å¤åŠ è½½
    }
    return false;
  },
  child: ListView(...),
);
```

**å¤§å›¾ç‰‡å¤„ç†**ï¼š
- å•å¼ å›¾ç‰‡å†…å­˜å ç”¨ä¸å¾—è¶…è¿‡40MBï¼ˆ1920Ã—1920Ã—4å­—èŠ‚â‰ˆ14MBï¼Œè€ƒè™‘è§£ç ç¼“å†²ï¼‰
- ä½¿ç”¨`imageCache.clear()`åœ¨å†…å­˜è­¦å‘Šæ—¶ï¼ˆ`didHaveMemoryPressure`ï¼‰æ¸…ç†ç¼“å­˜

### 5.3 ç½‘ç»œä¼˜åŒ–

**è¯·æ±‚åˆå¹¶**ï¼š
- é¦–é¡µFeedæ¥å£ä¸€æ¬¡æ€§è¿”å›å¸–å­åˆ—è¡¨+ç”¨æˆ·ä¿¡æ¯ï¼ˆé¿å…N+1æŸ¥è¯¢ï¼‰
- å›¾ç‰‡ä½¿ç”¨CDNåŸŸååˆ†ç‰‡ï¼ˆimg1.example.com, img2.example.comï¼‰æå‡å¹¶å‘

**å‹ç¼©ç­–ç•¥**ï¼š
- è¯·æ±‚ä½“å¯ç”¨Gzipå‹ç¼©ï¼ˆDioé»˜è®¤å¼€å¯ï¼‰
- å“åº”ä½“>1KBæ—¶å¯ç”¨å‹ç¼©

---

## **6. é”™è¯¯å¤„ç†ä¸ç›‘æ§**

### 6.1 å…¨å±€é”™è¯¯è¾¹ç•Œ

```dart
class AppErrorWidget extends StatelessWidget {
  final FlutterErrorDetails details;
  
  @override
  Widget build(BuildContext context) {
    // å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é”™è¯¯å †æ ˆ
    // ç”Ÿäº§ç¯å¢ƒæ˜¾ç¤ºå‹å¥½æç¤ºï¼š"å‡ºé”™äº†ï¼Œç‚¹å‡»åˆ·æ–°"
    // ä¸ŠæŠ¥è‡³Sentry/Crashlytics
  }
}

// main.dart
FlutterError.onError = (details) {
  Zone.current.handleUncaughtError(details.exception, details.stack!);
};

runZonedGuarded(() {
  runApp(MyApp());
}, (error, stack) {
  // ä¸ŠæŠ¥è‡³ç›‘æ§ç³»ç»Ÿ
  CrashReporter.report(error, stack);
});
```

### 6.2 ä¸šåŠ¡é”™è¯¯ç å¤„ç†

| é”™è¯¯ç  | å®¢æˆ·ç«¯è¡Œä¸º | æç¤ºæ–‡æ¡ˆ |
|--------|-----------|---------|
| 401 | Tokenè¿‡æœŸ â†’ è‡ªåŠ¨åˆ·æ–° â†’ é‡è¯•åŸè¯·æ±‚ | é™é»˜å¤„ç†ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ |
| 403 | è·³è½¬ç™»å½•é¡µ | "ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•" |
| 429 | é™æµ â†’ æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ1s, 2s, 4sï¼‰ | "æ“ä½œå¤ªé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•" |
| 500 | æ˜¾ç¤ºé‡è¯•æŒ‰é’® | "æœåŠ¡å™¨ç¹å¿™ï¼Œç‚¹å‡»é‡è¯•" |
| Network Error | æ£€æµ‹ç½‘ç»œçŠ¶æ€ â†’ æ˜¾ç¤ºç¦»çº¿å ä½é¡µ | "ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥ç½‘ç»œè®¾ç½®" |

### 6.3 åŸ‹ç‚¹è§„èŒƒ

ä½¿ç”¨`firebase_analytics`æˆ–è‡ªç ”åŸ‹ç‚¹åº“ï¼Œå¿…é¡»é‡‡é›†çš„äº‹ä»¶ï¼š

**å†…å®¹æ¶ˆè´¹**ï¼š
- `feed_impression`ï¼šå¸–å­æ›å…‰ï¼ˆè¿›å…¥å¯è§†åŒºåŸŸ50%ä»¥ä¸Šï¼Œåœç•™>500msï¼‰
- `tag_click`ï¼šæ ‡ç­¾ç‚¹å‡»ï¼ˆæºå¸¦post_id, tag_id, positionï¼‰
- `product_detail_view`ï¼šæŸ¥çœ‹å•†å“è¯¦æƒ…
- `purchase_intent`ï¼šç‚¹å‡»"å»è´­ä¹°"ï¼ˆæºå¸¦å•†å“å¹³å°ã€ä»·æ ¼ï¼‰

**å†…å®¹ç”Ÿäº§**ï¼š
- `post_start_create`ï¼šç‚¹å‡»å‘å¸ƒæŒ‰é’®
- `image_upload_success`ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ˆè€—æ—¶ã€å›¾ç‰‡å¤§å°ï¼‰
- `tag_add`ï¼šæ·»åŠ å•†å“æ ‡ç­¾ï¼ˆæºå¸¦æ˜¯å¦ä½¿ç”¨é€‰å“åº“ï¼‰
- `post_publish`ï¼šå‘å¸ƒæˆåŠŸï¼ˆæºå¸¦æ ‡ç­¾æ•°é‡ã€ç¼–è¾‘æ—¶é•¿ï¼‰

**äº¤æ˜“**ï¼š
- `commission_settled`ï¼šä½£é‡‘ç»“ç®—åˆ°è´¦

---

## **7. å®‰å…¨ä¸åˆè§„**

### 7.1 æ•°æ®å®‰å…¨

- **æ•æ„Ÿä¿¡æ¯**ï¼šPIDã€èº«ä»½è¯å·ä½¿ç”¨`flutter_secure_storage`å­˜å‚¨ï¼ˆiOS Keychain/Android Keystoreï¼‰
- **ç½‘ç»œä¼ è¾“**ï¼šç¦ç”¨æ˜æ–‡HTTPï¼Œä»…å…è®¸HTTPSï¼›è¯ä¹¦é”å®šï¼ˆSSL Pinningï¼‰é˜²æ­¢ä¸­é—´äººæ”»å‡»
- **ä»£ç å®‰å…¨**ï¼šå¯ç”¨Dartæ··æ·†ï¼ˆ`--obfuscate`ï¼‰ï¼ŒNativeä»£ç å­—ç¬¦ä¸²åŠ å¯†

### 7.2 éšç§åˆè§„

**Android**ï¼š
- targetSdkVersion 33+ï¼ˆé€‚é…Android 14ï¼‰
- éšç§æ”¿ç­–å¼¹çª—ï¼šé¦–æ¬¡å¯åŠ¨å¿…é¡»åŒæ„åæ‰èƒ½è·å–è®¾å¤‡ä¿¡æ¯
- ä»…åœ¨éœ€è¦æ—¶ç”³è¯·æƒé™ï¼ˆå¦‚ç‚¹å‡»"å‘å¸ƒ"æ—¶æ‰ç”³è¯·ç›¸å†Œæƒé™ï¼‰

**iOS**ï¼š
- App Tracking Transparencyï¼šè·å–IDFAå‰å¿…é¡»å¼¹çª—è¯´æ˜ç”¨é€”
- Privacy Nutrition Labelsï¼šåœ¨App Store Connectä¸­å‡†ç¡®å£°æ˜æ•°æ®ä½¿ç”¨ç±»å‹

---

## **8. å¼€å‘ä¸æµ‹è¯•è§„èŒƒ**

### 8.1 ä»£ç è§„èŒƒ

**Lintè§„åˆ™**ï¼šå¯ç”¨`flutter_lints`ä¸¥æ ¼æ¨¡å¼ï¼Œé¢å¤–æ·»åŠ ï¼š
```yaml
analyzer:
  errors:
    avoid_print: warning  # ç¦æ­¢ç›´æ¥ä½¿ç”¨printï¼Œä½¿ç”¨Logger
    prefer_single_quotes: true
    lines_longer_than_80_chars: warning
```

**å‘½åè§„èŒƒ**ï¼š
- æ–‡ä»¶åï¼šsnake_caseï¼ˆ`image_tag_editor.dart`ï¼‰
- ç±»åï¼šUpperCamelCaseï¼ˆ`ImageTagEditor`ï¼‰
- æ–¹æ³•åï¼šlowerCamelCaseï¼ˆ`calculatePosition`ï¼‰
- ç§æœ‰æˆå‘˜ï¼š_å‰ç¼€ï¼ˆ`_currentTags`ï¼‰

### 8.2 æµ‹è¯•ç­–ç•¥

| ç±»å‹ | è¦†ç›–ç‡è¦æ±‚ | å·¥å…· |
|------|-----------|------|
| **å•å…ƒæµ‹è¯•** | ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆDomainï¼‰>80% | `flutter_test` + `mockito` |
| **Widgetæµ‹è¯•** | æ ¸å¿ƒç»„ä»¶ï¼ˆç¼–è¾‘å™¨ã€Feedå¡ç‰‡ï¼‰ | `widgetTest` |
| **é›†æˆæµ‹è¯•** | å‘å¸ƒæµç¨‹ã€æ”¯ä»˜æµç¨‹å…³é”®è·¯å¾„ | `integration_test` |
| **Goldenæµ‹è¯•** | UIå›å½’æµ‹è¯• | `golden_toolkit` |

**å…³é”®æµ‹è¯•ç”¨ä¾‹**ï¼š
- æ ‡ç­¾æ‹–æ‹½è¾¹ç•Œå€¼æµ‹è¯•ï¼ˆåæ ‡0.0å’Œ1.0ï¼‰
- è½¬é“¾æ¥å£500é”™è¯¯æ—¶çš„é™çº§å¤„ç†ï¼ˆæ˜¾ç¤º"è½¬é“¾å¤±è´¥ï¼Œè¯·é‡è¯•"ï¼‰
- å¼±ç½‘ç¯å¢ƒä¸‹å›¾ç‰‡ä¸Šä¼ çš„æ–­ç‚¹ç»­ä¼ 

---

## **9. æ„å»ºä¸éƒ¨ç½²é…ç½®**

### 9.1 ç¯å¢ƒç®¡ç†

| ç¯å¢ƒ | APIç«¯ç‚¹ | åŠŸèƒ½å¼€å…³ | æ„å»ºå‘½ä»¤ |
|------|---------|---------|---------|
| Dev | `https://dev-api.jinrichuanda.com` | æ—¥å¿—å…¨å¼€ã€è°ƒè¯•é¢æ¿ | `flutter run --flavor dev` |
| Staging | `https://staging-api.jinrichuanda.com` | é¢„å‘å¸ƒæµ‹è¯• | `flutter build apk --flavor staging` |
| Prod | `https://api.jinrichuanda.com` | å…³é—­è°ƒè¯•ã€å¯ç”¨å´©æºƒä¸ŠæŠ¥ | `flutter build ios --release --flavor prod` |

### 9.2 æ„å»ºè®¾ç½®

**Android**ï¼š
- minSdkVersion: 21ï¼ˆAndroid 5.0ï¼Œè¦†ç›–98%è®¾å¤‡ï¼‰
- targetSdkVersion: 34
- å¯ç”¨ProGuardæ··æ·†ï¼ˆ`android/app/build.gradle`ï¼‰
- åˆ†ç¦»ABIæ„å»ºï¼ˆåˆ†åˆ«æ‰“åŒ…arm64-v8aã€armeabi-v7aä»¥å‡å°‘åŒ…ä½“ç§¯ï¼‰

**iOS**ï¼š
- æœ€ä½ç‰ˆæœ¬ï¼šiOS 12.0
- å¯ç”¨Bitcode: Noï¼ˆFlutter 3.0+ä¸å†æ”¯æŒBitcodeï¼‰
- æ¶æ„ï¼šarm64ï¼ˆiPhone 5s+ï¼Œæ”¾å¼ƒ32ä½æ”¯æŒï¼‰

---

## **10. é™„å½•**

### 10.1 ç¬¬ä¸‰æ–¹æœåŠ¡APIå¯†é’¥æ¸…å•

| æœåŠ¡ | ç”¨é€” | é…ç½®ä½ç½® |
|------|------|---------|
| æ·˜å®è”ç›ŸAppKey | å•†å“è½¬é“¾ | `lib/core/constants/api_keys.dart`ï¼ˆGitå¿½ç•¥ï¼‰ |
| é˜¿é‡Œäº‘OSS | å›¾ç‰‡ä¸Šä¼  | ç¯å¢ƒå˜é‡ |
| Sentry DSN | å´©æºƒç›‘æ§ | `main.dart`åˆå§‹åŒ– |
| Google Analytics | æ•°æ®åˆ†æ | `AndroidManifest.xml` + `Info.plist` |

### 10.2 è®¾è®¡èµ„æº

- **è®¾è®¡ç¨¿**ï¼šFigmaé“¾æ¥ï¼ˆå¾…è¡¥å……ï¼‰
- **å›¾æ ‡åº“**ï¼šä½¿ç”¨`phosphor_flutter`ï¼ˆä¸Material Design 3é£æ ¼ä¸€è‡´ï¼‰
- **æ’ç”»é£**ï¼šæ‰å¹³åŒ–ã€æ—¶å°šé…è‰²ï¼ˆä¸»è‰²ï¼š#FF6B9Dï¼Œè¾…è‰²ï¼š#4ECDC4ï¼‰

### 10.3 å¸¸è§é—®é¢˜ï¼ˆFAQï¼‰

**Qï¼šå¦‚ä½•å¤„ç†æ·˜å®é“¾æ¥åœ¨iOSç«¯è¢«Universal Linkæ‹¦æˆªï¼Ÿ**  
Aï¼šåœ¨ç‚¹å‡»å•†å“è·³è½¬æ—¶ï¼Œå…ˆå°è¯•æ‰“å¼€URL Schemeï¼Œè‹¥è¿”å›`false`ï¼ˆæœªå®‰è£…APPï¼‰ï¼Œåˆ™é™çº§åˆ°H5é¡µé¢ï¼Œå¹¶æç¤ºç”¨æˆ·"ç‚¹å‡»å³ä¸Šè§’åœ¨Safariä¸­æ‰“å¼€"ä»¥è§¦å‘Universal Linkã€‚

**Qï¼šå›¾ç‰‡æ ‡ç­¾åœ¨å¤§å±iPadä¸Šå¦‚ä½•é€‚é…ï¼Ÿ**  
Aï¼šä½¿ç”¨`LayoutBuilder`æ£€æµ‹å±å¹•å®½åº¦ï¼Œå½“å®½åº¦>600pxæ—¶ï¼Œé‡‡ç”¨å·¦å³åˆ†æ å¸ƒå±€ï¼ˆå·¦ä¾§å¤§å›¾+æ ‡ç­¾ç¼–è¾‘å™¨ï¼Œå³ä¾§é€‰å“åº“ï¼‰ï¼Œè€Œéæ‰‹æœºç«¯çš„ä¸Šä¸‹å¸ƒå±€ã€‚

---

æœ¬è§„èŒƒä½œä¸ºFlutterå¼€å‘çš„**å”¯ä¸€å‚è€ƒæ ‡å‡†**ï¼Œæ‰€æœ‰æŠ€æœ¯æ–¹æ¡ˆé€‰æ‹©å¿…é¡»ä»¥æœ¬æ–‡æ¡£ä¸ºå‡†ã€‚å¦‚æœ‰æŠ€æœ¯éš¾ç‚¹æˆ–éœ€è°ƒæ•´æ¶æ„ï¼Œéœ€é€šè¿‡æŠ€æœ¯è¯„å®¡ä¼šè®®ï¼ˆå«æ¶æ„å¸ˆã€UIè´Ÿè´£äººã€åç«¯ä»£è¡¨ï¼‰è®¨è®ºåæ–¹å¯å˜æ›´ã€‚